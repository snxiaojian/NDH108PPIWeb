{"ast":null,"code":"var _jsxFileName = \"/home/sunxiaojian/project/108\\u4E92\\u4F5C\\u7F51\\u7AD9/protein-interaction-site/src/components/ProteinNetwork.js\",\n  _s = $RefreshSig$();\nimport React, { useEffect, useRef, useState } from 'react';\nimport * as d3 from 'd3';\nimport { useSpring, animated } from '@react-spring/web';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nfunction ProteinNetwork({\n  onSelectProtein\n}) {\n  _s();\n  const svgRef = useRef(null);\n  const [data, setData] = useState({\n    nodes: [],\n    links: []\n  });\n\n  // 转换互作数据为网络图数据\n  const transformData = interactions => {\n    const nodesMap = new Map();\n    const links = [];\n\n    // 处理互作数据\n    interactions.forEach(interaction => {\n      const source = interaction['Protein 1'];\n      const target = interaction['Protein 2'];\n      const score = parseFloat(interaction.Score);\n\n      // 添加节点\n      if (!nodesMap.has(source)) {\n        nodesMap.set(source, {\n          id: source\n        });\n      }\n      if (!nodesMap.has(target)) {\n        nodesMap.set(target, {\n          id: target\n        });\n      }\n\n      // 添加链接\n      links.push({\n        source,\n        target,\n        value: score\n      });\n    });\n    return {\n      nodes: Array.from(nodesMap.values()),\n      links\n    };\n  };\n\n  // 加载互作数据\n  useEffect(() => {\n    const fetchData = async () => {\n      try {\n        const response = await fetch('/api/interactions');\n        const interactions = await response.json();\n        const graphData = transformData(interactions);\n        setData(graphData);\n      } catch (error) {\n        console.error('Failed to fetch interactions:', error);\n      }\n    };\n    fetchData();\n  }, []);\n\n  // 力导向图配置\n  const {\n    width,\n    height\n  } = useSpring({\n    width: 800,\n    height: 600,\n    config: {\n      mass: 1,\n      tension: 170,\n      friction: 26\n    }\n  });\n  useEffect(() => {\n    const svg = d3.select(svgRef.current);\n\n    // 创建力导向图模拟\n    const simulation = d3.forceSimulation(data.nodes).force('link', d3.forceLink(data.links).id(d => d.id).distance(100)).force('charge', d3.forceManyBody().strength(-200)).force('center', d3.forceCenter(width, height / 2)).force('collision', d3.forceCollide().radius(30));\n\n    // 创建链接\n    const link = svg.append('g').selectAll('line').data(data.links).join('line').attr('stroke', d => d.value === 1 ? '#1976d2' : '#999').attr('stroke-opacity', d => d.value === 1 ? 1 : 0.6).attr('stroke-width', d => d.value === 1 ? 2 : Math.sqrt(d.value || 1)).attr('stroke-dasharray', d => d.value === 1 ? null : '2,2');\n\n    // 创建节点\n    const node = svg.append('g').attr('stroke', '#fff').attr('stroke-width', 1.5).selectAll('circle').data(data.nodes).join('circle').attr('r', 8).attr('fill', '#1976d2').call(d3.drag().on('start', dragstarted).on('drag', dragged).on('end', dragended)).on('click', (event, d) => {\n      onSelectProtein(d.id);\n    }).on('mouseover', function () {\n      d3.select(this).transition().duration(100).attr('r', 12).attr('fill', '#ff7f0e');\n    }).on('mouseout', function () {\n      d3.select(this).transition().duration(100).attr('r', 8).attr('fill', '#1976d2');\n    });\n\n    // 添加节点标签\n    const label = svg.append('g').selectAll('text').data(data.nodes).join('text').text(d => d.id).attr('font-size', 10).attr('dx', 12).attr('dy', '.35em');\n\n    // 动画更新\n    simulation.on('tick', () => {\n      link.attr('x1', d => d.source.x).attr('y1', d => d.source.y).attr('x2', d => d.target.x).attr('y2', d => d.target.y);\n      node.attr('cx', d => d.x).attr('cy', d => d.y);\n      label.attr('x', d => d.x).attr('y', d => d.y);\n    });\n\n    // 拖拽事件处理\n    function dragstarted(event, d) {\n      if (!event.active) simulation.alphaTarget(0.3).restart();\n      d.fx = d.x;\n      d.fy = d.y;\n    }\n    function dragged(event, d) {\n      d.fx = event.x;\n      d.fy = event.y;\n    }\n    function dragended(event, d) {\n      if (!event.active) simulation.alphaTarget(0);\n      d.fx = null;\n      d.fy = null;\n    }\n  }, [data, width, height]);\n  return /*#__PURE__*/_jsxDEV(animated.svg, {\n    ref: svgRef,\n    style: {\n      width: width,\n      height: height\n    }\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 168,\n    columnNumber: 5\n  }, this);\n}\n_s(ProteinNetwork, \"CYhba2qjzW7r9OqMEUHGvHMe3dI=\", false, function () {\n  return [useSpring];\n});\n_c = ProteinNetwork;\nexport default ProteinNetwork;\nvar _c;\n$RefreshReg$(_c, \"ProteinNetwork\");","map":{"version":3,"names":["React","useEffect","useRef","useState","d3","useSpring","animated","jsxDEV","_jsxDEV","ProteinNetwork","onSelectProtein","_s","svgRef","data","setData","nodes","links","transformData","interactions","nodesMap","Map","forEach","interaction","source","target","score","parseFloat","Score","has","set","id","push","value","Array","from","values","fetchData","response","fetch","json","graphData","error","console","width","height","config","mass","tension","friction","svg","select","current","simulation","forceSimulation","force","forceLink","d","distance","forceManyBody","strength","forceCenter","forceCollide","radius","link","append","selectAll","join","attr","Math","sqrt","node","call","drag","on","dragstarted","dragged","dragended","event","transition","duration","label","text","x","y","active","alphaTarget","restart","fx","fy","ref","style","fileName","_jsxFileName","lineNumber","columnNumber","_c","$RefreshReg$"],"sources":["/home/sunxiaojian/project/108互作网站/protein-interaction-site/src/components/ProteinNetwork.js"],"sourcesContent":["import React, { useEffect, useRef, useState } from 'react';\nimport * as d3 from 'd3';\nimport { useSpring, animated } from '@react-spring/web';\n\nfunction ProteinNetwork({ onSelectProtein }) {\n  const svgRef = useRef(null);\n  const [data, setData] = useState({\n    nodes: [],\n    links: []\n  });\n\n  // 转换互作数据为网络图数据\n  const transformData = (interactions) => {\n    const nodesMap = new Map();\n    const links = [];\n    \n    // 处理互作数据\n    interactions.forEach(interaction => {\n      const source = interaction['Protein 1'];\n      const target = interaction['Protein 2'];\n      const score = parseFloat(interaction.Score);\n      \n      // 添加节点\n      if (!nodesMap.has(source)) {\n        nodesMap.set(source, { id: source });\n      }\n      if (!nodesMap.has(target)) {\n        nodesMap.set(target, { id: target });\n      }\n      \n      // 添加链接\n      links.push({\n        source,\n        target,\n        value: score\n      });\n    });\n    \n    return {\n      nodes: Array.from(nodesMap.values()),\n      links\n    };\n  };\n\n  // 加载互作数据\n  useEffect(() => {\n    const fetchData = async () => {\n      try {\n        const response = await fetch('/api/interactions');\n        const interactions = await response.json();\n        const graphData = transformData(interactions);\n        setData(graphData);\n      } catch (error) {\n        console.error('Failed to fetch interactions:', error);\n      }\n    };\n\n    fetchData();\n  }, []);\n\n  // 力导向图配置\n  const { width, height } = useSpring({\n    width: 800,\n    height: 600,\n    config: { mass: 1, tension: 170, friction: 26 }\n  });\n\n  useEffect(() => {\n    const svg = d3.select(svgRef.current);\n\n    // 创建力导向图模拟\n    const simulation = d3.forceSimulation(data.nodes)\n      .force('link', d3.forceLink(data.links).id(d => d.id).distance(100))\n      .force('charge', d3.forceManyBody().strength(-200))\n      .force('center', d3.forceCenter(width, height / 2))\n      .force('collision', d3.forceCollide().radius(30));\n\n  // 创建链接\n  const link = svg.append('g')\n    .selectAll('line')\n    .data(data.links)\n    .join('line')\n    .attr('stroke', d => d.value === 1 ? '#1976d2' : '#999')\n    .attr('stroke-opacity', d => d.value === 1 ? 1 : 0.6)\n    .attr('stroke-width', d => d.value === 1 ? 2 : Math.sqrt(d.value || 1))\n    .attr('stroke-dasharray', d => d.value === 1 ? null : '2,2');\n\n  // 创建节点\n  const node = svg.append('g')\n    .attr('stroke', '#fff')\n    .attr('stroke-width', 1.5)\n    .selectAll('circle')\n    .data(data.nodes)\n    .join('circle')\n    .attr('r', 8)\n    .attr('fill', '#1976d2')\n    .call(d3.drag()\n      .on('start', dragstarted)\n      .on('drag', dragged)\n      .on('end', dragended)\n    )\n    .on('click', (event, d) => {\n      onSelectProtein(d.id);\n    })\n    .on('mouseover', function() {\n      d3.select(this)\n        .transition()\n        .duration(100)\n        .attr('r', 12)\n        .attr('fill', '#ff7f0e');\n    })\n    .on('mouseout', function() {\n      d3.select(this)\n        .transition()\n        .duration(100)\n        .attr('r', 8)\n        .attr('fill', '#1976d2');\n    });\n\n    // 添加节点标签\n    const label = svg.append('g')\n      .selectAll('text')\n      .data(data.nodes)\n      .join('text')\n      .text(d => d.id)\n      .attr('font-size', 10)\n      .attr('dx', 12)\n      .attr('dy', '.35em');\n\n    // 动画更新\n    simulation.on('tick', () => {\n      link\n        .attr('x1', d => d.source.x)\n        .attr('y1', d => d.source.y)\n        .attr('x2', d => d.target.x)\n        .attr('y2', d => d.target.y);\n\n      node\n        .attr('cx', d => d.x)\n        .attr('cy', d => d.y);\n\n      label\n        .attr('x', d => d.x)\n        .attr('y', d => d.y);\n    });\n\n    // 拖拽事件处理\n    function dragstarted(event, d) {\n      if (!event.active) simulation.alphaTarget(0.3).restart();\n      d.fx = d.x;\n      d.fy = d.y;\n    }\n\n    function dragged(event, d) {\n      d.fx = event.x;\n      d.fy = event.y;\n    }\n\n    function dragended(event, d) {\n      if (!event.active) simulation.alphaTarget(0);\n      d.fx = null;\n      d.fy = null;\n    }\n\n  }, [data, width, height]);\n\n  return (\n    <animated.svg \n      ref={svgRef}\n      style={{ width: width, height: height }}\n    ></animated.svg>\n  );\n}\n\nexport default ProteinNetwork;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}
{"ast":null,"code":"import React,{useEffect,useRef,useState}from'react';import{Box,CircularProgress}from'@mui/material';import{Network}from'vis-network';import{DataSet}from'vis-data';import{API_BASE_URL}from'../config';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";function ProteinNetwork(_ref){let{onSelectProtein}=_ref;const containerRef=useRef(null);const networkRef=useRef(null);const[loading,setLoading]=useState(false);const[error,setError]=useState(null);const[data,setData]=useState(null);// 获取数据\nuseEffect(()=>{const fetchData=async()=>{try{setLoading(true);setError(null);const response=await fetch(`${API_BASE_URL}/interactions`);if(!response.ok)throw new Error('Failed to fetch data');const result=await response.json();setData(result);}catch(err){setError(err.message);}finally{setLoading(false);}};fetchData();},[]);// 初始化网络\nuseEffect(()=>{if(!data||!containerRef.current)return;const nodes=new DataSet();const edges=new DataSet();const addedNodes=new Set();data.forEach(interaction=>{const{protein1,protein2,score}=interaction;if(!addedNodes.has(protein1)){nodes.add({id:protein1,label:protein1});addedNodes.add(protein1);}if(!addedNodes.has(protein2)){nodes.add({id:protein2,label:protein2});addedNodes.add(protein2);}edges.add({from:protein1,to:protein2,width:parseFloat(score)*2,color:parseFloat(score)===1?'#ff0000':'#999999'});});const options={nodes:{shape:'dot',size:16,font:{size:12,color:'#333333'},borderWidth:2,color:{background:'#ffffff',border:'#2B7CE9'}},edges:{smooth:{type:'continuous'}},physics:{stabilization:true,barnesHut:{gravitationalConstant:-80000,springConstant:0.001,springLength:200}},interaction:{hover:true,tooltipDelay:200}};// 清理旧的网络实例\nif(networkRef.current){networkRef.current.destroy();networkRef.current=null;}// 创建新的网络实例\nconst network=new Network(containerRef.current,{nodes,edges},options);// 添加事件监听器\nnetwork.on('selectNode',params=>{if(params.nodes.length>0){onSelectProtein(params.nodes[0]);}});networkRef.current=network;// 清理函数\nreturn()=>{if(networkRef.current){try{networkRef.current.destroy();networkRef.current=null;}catch(e){console.error('Error destroying network:',e);}}};},[data,onSelectProtein]);if(loading){return/*#__PURE__*/_jsx(Box,{display:\"flex\",justifyContent:\"center\",alignItems:\"center\",height:\"500px\",children:/*#__PURE__*/_jsx(CircularProgress,{})});}if(error){return/*#__PURE__*/_jsxs(Box,{display:\"flex\",justifyContent:\"center\",alignItems:\"center\",height:\"500px\",color:\"error.main\",children:[\"Error: \",error]});}return/*#__PURE__*/_jsx(Box,{ref:containerRef,sx:{height:'500px',border:'1px solid #ddd',borderRadius:1,overflow:'hidden'}});}export default ProteinNetwork;","map":{"version":3,"names":["React","useEffect","useRef","useState","Box","CircularProgress","Network","DataSet","API_BASE_URL","jsx","_jsx","jsxs","_jsxs","ProteinNetwork","_ref","onSelectProtein","containerRef","networkRef","loading","setLoading","error","setError","data","setData","fetchData","response","fetch","ok","Error","result","json","err","message","current","nodes","edges","addedNodes","Set","forEach","interaction","protein1","protein2","score","has","add","id","label","from","to","width","parseFloat","color","options","shape","size","font","borderWidth","background","border","smooth","type","physics","stabilization","barnesHut","gravitationalConstant","springConstant","springLength","hover","tooltipDelay","destroy","network","on","params","length","e","console","display","justifyContent","alignItems","height","children","ref","sx","borderRadius","overflow"],"sources":["/Users/sxiaojian/NDH108PPIWeb/protein-interaction-site/src/components/ProteinNetwork.js"],"sourcesContent":["import React, { useEffect, useRef, useState } from 'react';\nimport { Box, CircularProgress } from '@mui/material';\nimport { Network } from 'vis-network';\nimport { DataSet } from 'vis-data';\nimport { API_BASE_URL } from '../config';\n\nfunction ProteinNetwork({ onSelectProtein }) {\n  const containerRef = useRef(null);\n  const networkRef = useRef(null);\n  const [loading, setLoading] = useState(false);\n  const [error, setError] = useState(null);\n  const [data, setData] = useState(null);\n\n  // 获取数据\n  useEffect(() => {\n    const fetchData = async () => {\n      try {\n        setLoading(true);\n        setError(null);\n\n        const response = await fetch(`${API_BASE_URL}/interactions`);\n        if (!response.ok) throw new Error('Failed to fetch data');\n        const result = await response.json();\n        setData(result);\n      } catch (err) {\n        setError(err.message);\n      } finally {\n        setLoading(false);\n      }\n    };\n\n    fetchData();\n  }, []);\n\n  // 初始化网络\n  useEffect(() => {\n    if (!data || !containerRef.current) return;\n\n    const nodes = new DataSet();\n    const edges = new DataSet();\n    const addedNodes = new Set();\n\n    data.forEach(interaction => {\n      const { protein1, protein2, score } = interaction;\n      \n      if (!addedNodes.has(protein1)) {\n        nodes.add({ id: protein1, label: protein1 });\n        addedNodes.add(protein1);\n      }\n      if (!addedNodes.has(protein2)) {\n        nodes.add({ id: protein2, label: protein2 });\n        addedNodes.add(protein2);\n      }\n\n      edges.add({\n        from: protein1,\n        to: protein2,\n        width: parseFloat(score) * 2,\n        color: parseFloat(score) === 1 ? '#ff0000' : '#999999'\n      });\n    });\n\n    const options = {\n      nodes: {\n        shape: 'dot',\n        size: 16,\n        font: {\n          size: 12,\n          color: '#333333'\n        },\n        borderWidth: 2,\n        color: {\n          background: '#ffffff',\n          border: '#2B7CE9'\n        }\n      },\n      edges: {\n        smooth: {\n          type: 'continuous'\n        }\n      },\n      physics: {\n        stabilization: true,\n        barnesHut: {\n          gravitationalConstant: -80000,\n          springConstant: 0.001,\n          springLength: 200\n        }\n      },\n      interaction: {\n        hover: true,\n        tooltipDelay: 200\n      }\n    };\n\n    // 清理旧的网络实例\n    if (networkRef.current) {\n      networkRef.current.destroy();\n      networkRef.current = null;\n    }\n\n    // 创建新的网络实例\n    const network = new Network(containerRef.current, { nodes, edges }, options);\n    \n    // 添加事件监听器\n    network.on('selectNode', (params) => {\n      if (params.nodes.length > 0) {\n        onSelectProtein(params.nodes[0]);\n      }\n    });\n\n    networkRef.current = network;\n\n    // 清理函数\n    return () => {\n      if (networkRef.current) {\n        try {\n          networkRef.current.destroy();\n          networkRef.current = null;\n        } catch (e) {\n          console.error('Error destroying network:', e);\n        }\n      }\n    };\n  }, [data, onSelectProtein]);\n\n  if (loading) {\n    return (\n      <Box display=\"flex\" justifyContent=\"center\" alignItems=\"center\" height=\"500px\">\n        <CircularProgress />\n      </Box>\n    );\n  }\n\n  if (error) {\n    return (\n      <Box display=\"flex\" justifyContent=\"center\" alignItems=\"center\" height=\"500px\" color=\"error.main\">\n        Error: {error}\n      </Box>\n    );\n  }\n\n  return (\n    <Box\n      ref={containerRef}\n      sx={{\n        height: '500px',\n        border: '1px solid #ddd',\n        borderRadius: 1,\n        overflow: 'hidden'\n      }}\n    />\n  );\n}\n\nexport default ProteinNetwork;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}